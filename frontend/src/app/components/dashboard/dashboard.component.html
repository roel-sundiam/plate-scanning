<div class="dashboard-container">
  <div class="dashboard-header">
    <h1>License Plate Detection Dashboard</h1>
    <button mat-raised-button color="primary" (click)="loadStatistics()">
      <mat-icon>refresh</mat-icon>
      Refresh
    </button>
  </div>

  <!-- Detection Control Panel -->
  <app-detection-control></app-detection-control>

  <div *ngIf="loading" class="loading-container">
    <mat-spinner></mat-spinner>
    <p>Loading statistics...</p>
  </div>

  <div *ngIf="error" class="error-message">
    <mat-icon>error</mat-icon>
    <p>{{ error }}</p>
    <button mat-raised-button color="accent" (click)="loadStatistics()">Retry</button>
  </div>

  <div *ngIf="!loading && !error && stats" class="stats-grid">
    <!-- Summary Cards -->
    <mat-card class="stat-card highlight">
      <mat-card-content>
        <div class="stat-icon">
          <mat-icon>directions_car</mat-icon>
        </div>
        <div class="stat-info">
          <h2>{{ stats.summary.totalDetections }}</h2>
          <p>Total Detections</p>
        </div>
      </mat-card-content>
    </mat-card>

    <mat-card class="stat-card highlight">
      <mat-card-content>
        <div class="stat-icon">
          <mat-icon>filter_list</mat-icon>
        </div>
        <div class="stat-info">
          <h2>{{ stats.summary.uniquePlatesCount }}</h2>
          <p>Unique Plates</p>
        </div>
      </mat-card-content>
    </mat-card>

    <mat-card class="stat-card highlight">
      <mat-card-content>
        <div class="stat-icon">
          <mat-icon>verified</mat-icon>
        </div>
        <div class="stat-info">
          <h2>{{ stats.summary.verifiedCount }}</h2>
          <p>Verified Plates</p>
        </div>
      </mat-card-content>
    </mat-card>

    <mat-card class="stat-card highlight">
      <mat-card-content>
        <div class="stat-icon">
          <mat-icon>schedule</mat-icon>
        </div>
        <div class="stat-info">
          <h2>{{ stats.recentPlates.length }}</h2>
          <p>Recent Activity</p>
        </div>
      </mat-card-content>
    </mat-card>

    <!-- Average Confidence -->
    <mat-card class="stat-card wide">
      <mat-card-header>
        <mat-card-title>Average Confidence</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="confidence-display">
          <div class="confidence-bar">
            <div 
              class="confidence-fill" 
              [style.width]="formatPercentage(stats.summary.avgConfidence)"
              [style.background-color]="getConfidenceColor(stats.summary.avgConfidence)">
            </div>
          </div>
          <div class="confidence-value" [style.color]="getConfidenceColor(stats.summary.avgConfidence)">
            {{ formatPercentage(stats.summary.avgConfidence) }}
          </div>
        </div>
      </mat-card-content>
    </mat-card>

    <!-- Top Plates -->
    <mat-card class="stat-card wide">
      <mat-card-header>
        <mat-card-title>Most Frequent Plates</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="top-plates-list">
          <div *ngFor="let plate of stats.topPlates" class="plate-item">
            <span class="plate-number">{{ plate._id }}</span>
            <span class="plate-count">{{ plate.count }} detections</span>
          </div>
          <div *ngIf="stats.topPlates.length === 0" class="empty-state">
            <mat-icon>inbox</mat-icon>
            <p>No plates detected yet</p>
          </div>
        </div>
      </mat-card-content>
    </mat-card>

    <!-- Recent Detections -->
    <mat-card class="stat-card wide chart-card">
      <mat-card-header>
        <mat-card-title>Recent Detections</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="recent-plates-list">
          <div *ngFor="let plate of stats.recentPlates" class="recent-plate-item">
            <div class="plate-info">
              <span class="plate-number">{{ plate.plateNumber }}</span>
              <span class="gate-id">{{ plate.gateId }}</span>
            </div>
            <div class="plate-meta">
              <span class="timestamp">{{ plate.timestamp | date: 'short' }}</span>
              <span class="confidence" [style.color]="getConfidenceColor(plate.confidence)">
                {{ formatPercentage(plate.confidence) }}
              </span>
            </div>
          </div>
          <div *ngIf="stats.recentPlates.length === 0" class="empty-state">
            <mat-icon>inbox</mat-icon>
            <p>No recent activity</p>
          </div>
        </div>
      </mat-card-content>
    </mat-card>
  </div>
</div>
